<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master Pro</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --background-color: #ffffff;
            --text-color: #333333;
            --card-bg: #f8f9fa;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        /* Theme Variables */
        .theme-dark {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --background-color: #1a1a1a;
            --text-color: #ecf0f1;
            --card-bg: #2c3e50;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }

        .theme-red {
            --primary-color: #c62828;
            --secondary-color: #b71c1c;
            --accent-color: #ef5350;
            --background-color: #fff5f5;
            --text-color: #333333;
            --card-bg: #ffebee;
        }

        .theme-green {
            --primary-color: #2e7d32;
            --secondary-color: #1b5e20;
            --accent-color: #66bb6a;
            --background-color: #f5fff5;
            --text-color: #333333;
            --card-bg: #e8f5e9;
        }

        .theme-blue {
            --primary-color: #1565c0;
            --secondary-color: #0d47a1;
            --accent-color: #42a5f5;
            --background-color: #f5f9ff;
            --text-color: #333333;
            --card-bg: #e3f2fd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            font-size: 28px;
        }

        .user-stats {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-box {
            background-color: var(--card-bg);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-box i {
            color: var(--accent-color);
        }

        .stat-value {
            font-weight: bold;
            color: var(--primary-color);
        }

        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .sidebar {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            height: fit-content;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .content-area {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            min-height: 80vh;
        }

        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--accent-color);
        }

        /* Lesson Cards */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .lesson-card {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .lesson-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .lesson-card.locked {
            opacity: 0.6;
            filter: grayscale(50%);
            cursor: not-allowed;
        }

        .lesson-card.locked::after {
            content: "🔒";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }

        .lesson-level {
            font-size: 12px;
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .lesson-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .lesson-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .lesson-xp {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .lesson-xp i {
            margin-right: 5px;
        }

        /* Typing Area */
        .typing-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .typing-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .typing-stats {
            display: flex;
            gap: 15px;
        }

        .typing-stat {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            font-size: 14px;
        }

        .typing-text {
            background-color: var(--background-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-size: 18px;
            line-height: 1.6;
            min-height: 150px;
            position: relative;
        }

        .typing-text .current {
            background-color: rgba(79, 195, 247, 0.3);
            border-bottom: 2px solid var(--accent-color);
        }

        .typing-text .correct {
            color: var(--success-color);
        }

        .typing-text .incorrect {
            color: var(--error-color);
            text-decoration: underline;
        }

        .typing-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            outline: none;
            transition: var(--transition);
        }

        .typing-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.3);
        }

        .typing-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-danger {
            background-color: var(--error-color);
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        /* Results Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-stat {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .result-stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .result-stat-label {
            font-size: 14px;
            color: #666;
        }

        .xp-earned {
            background-color: rgba(79, 195, 247, 0.2);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        .badge-earned {
            background-color: rgba(46, 204, 113, 0.2);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            color: var(--success-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Badges */
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .badge-card {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .badge-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        .badge-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .badge-desc {
            font-size: 12px;
            color: #666;
        }

        .badge-card.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .badge-card.locked .badge-icon {
            color: #ccc;
        }

        /* Progress Chart */
        .progress-chart {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .weekly-goal {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .goal-progress {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Settings Panel */
        .settings-panel {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 20px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.selected {
            border-color: var(--text-color);
            transform: scale(1.1);
        }

        .theme-default {
            background-color: #ffffff;
        }

        .theme-dark {
            background-color: #1a1a1a;
        }

        .theme-red {
            background-color: #fff5f5;
        }

        .theme-green {
            background-color: #f5fff5;
        }

        .theme-blue {
            background-color: #f5f9ff;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Keyboard */
        .keyboard-container {
            margin-top: 30px;
            background-color: var(--background-color);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        .keyboard-key {
            width: 40px;
            height: 40px;
            margin: 0 3px;
            background-color: var(--card-bg);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
            position: relative;
            user-select: none;
        }

        .keyboard-key.space {
            width: 300px;
        }

        .keyboard-key.active {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(2px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.2);
        }

        .keyboard-key.mistake {
            background-color: var(--error-color);
            color: white;
        }

        .keyboard-key.highlight {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { background-color: var(--accent-color); }
            50% { background-color: var(--primary-color); }
            100% { background-color: var(--accent-color); }
        }

        .keyboard-key .finger {
            position: absolute;
            bottom: 2px;
            font-size: 10px;
            color: #666;
        }

        /* Heatmap */
        .heatmap-container {
            margin-top: 20px;
        }

        .heatmap-key {
            position: relative;
        }

        .heatmap-value {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(231, 76, 60, 0.3);
            border-radius: 5px;
        }

        /* Competition Mode */
        .competition-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .player-area {
            flex: 1;
            background-color: var(--background-color);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .player-name {
            font-weight: bold;
        }

        .player-stats {
            display: flex;
            gap: 10px;
        }

        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .bounce {
            animation: bounce 0.5s;
        }

        .shake {
            animation: shake 0.3s;
        }

        .xp-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .xp-popup.show {
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .user-stats {
                flex-direction: column;
                gap: 10px;
                align-items: flex-end;
            }

            .stat-box {
                width: 100%;
                justify-content: flex-end;
            }

            .lessons-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .competition-container {
                flex-direction: column;
            }
        }

        /* Font Awesome Icons (embedded) */
        .fas {
            display: inline-block;
            font-style: normal;
            font-variant: normal;
            text-rendering: auto;
            line-height: 1;
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        .fa-keyboard:before {
            content: "\f11c";
        }

        .fa-trophy:before {
            content: "\f091";
        }

        .fa-chart-line:before {
            content: "\f201";
        }

        .fa-cog:before {
            content: "\f013";
        }

        .fa-gamepad:before {
            content: "\f11b";
        }

        .fa-home:before {
            content: "\f015";
        }

        .fa-book:before {
            content: "\f02d";
        }

        .fa-stopwatch:before {
            content: "\f2f2";
        }

        .fa-users:before {
            content: "\f0c0";
        }

        .fa-fire:before {
            content: "\f06d";
        }

        .fa-medal:before {
            content: "\f5a2";
        }

        .fa-star:before {
            content: "\f005";
        }

        .fa-bolt:before {
            content: "\f0e7";
        }

        .fa-check:before {
            content: "\f00c";
        }

        .fa-times:before {
            content: "\f00d";
        }

        .fa-tint:before {
            content: "\f043";
        }

        .fa-user:before {
            content: "\f007";
        }

        .fa-xmark:before {
            content: "\f00d";
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-keyboard"></i>
                <span>Typing Master Pro</span>
            </div>
            <div class="user-stats">
                <div class="stat-box">
                    <i class="fas fa-fire"></i>
                    <span>Streak: <span class="stat-value" id="streak-count">0</span> days</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-medal"></i>
                    <span>Level: <span class="stat-value" id="level-display">1</span></span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-star"></i>
                    <span>XP: <span class="stat-value" id="xp-display">0</span>/<span id="next-level-xp">200</span></span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" data-section="home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" data-section="lessons"><i class="fas fa-book"></i> Lessons</a></li>
                    <li><a href="#" data-section="tests"><i class="fas fa-stopwatch"></i> Typing Tests</a></li>
                    <li><a href="#" data-section="competition"><i class="fas fa-users"></i> Competition</a></li>
                    <li><a href="#" data-section="achievements"><i class="fas fa-trophy"></i> Achievements</a></li>
                    <li><a href="#" data-section="progress"><i class="fas fa-chart-line"></i> Progress</a></li>
                    <li><a href="#" data-section="games"><i class="fas fa-gamepad"></i> Typing Games</a></li>
                    <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </div>

            <div class="content-area" id="content-area">
                <!-- Home Section -->
                <div class="content-section" id="home-section">
                    <h2 class="section-title"><i class="fas fa-home"></i> Welcome to Typing Master Pro</h2>
                    <p>Improve your typing speed and accuracy with our gamified typing practice system. Complete lessons, earn XP, unlock achievements, and track your progress!</p>
                    
                    <div class="quick-stats" style="margin-top: 30px;">
                        <div class="weekly-goal">
                            <div class="goal-header">
                                <span>Weekly Goal</span>
                                <span><span id="current-week-xp">0</span>/500 XP</span>
                            </div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" id="weekly-progress-bar"></div>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">Continue Your Journey</h3>
                    <div class="lessons-grid" id="continue-lessons">
                        <!-- Dynamically populated with in-progress lessons -->
                    </div>

                    <h3 style="margin-top: 30px;">Recommended Lessons</h3>
                    <div class="lessons-grid" id="recommended-lessons">
                        <!-- Dynamically populated with recommended lessons -->
                    </div>
                </div>

                <!-- Lessons Section -->
                <div class="content-section" id="lessons-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-book"></i> Typing Lessons</h2>
                    <p>Complete lessons to improve your typing skills and earn XP. Lessons unlock as you level up.</p>
                    
                    <h3 style="margin-top: 20px;">Beginner Lessons</h3>
                    <div class="lessons-grid" id="beginner-lessons">
                        <!-- Dynamically populated -->
                    </div>

                    <h3 style="margin-top: 20px;">Intermediate Lessons</h3>
                    <div class="lessons-grid" id="intermediate-lessons">
                        <!-- Dynamically populated -->
                    </div>

                    <h3 style="margin-top: 20px;">Advanced Lessons</h3>
                    <div class="lessons-grid" id="advanced-lessons">
                        <!-- Dynamically populated -->
                    </div>

                    <h3 style="margin-top: 20px;">Specialized Lessons</h3>
                    <div class="lessons-grid" id="specialized-lessons">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Typing Test Section -->
                <div class="content-section" id="tests-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-stopwatch"></i> Typing Tests</h2>
                    <p>Test your typing speed under time pressure. Choose a duration and see how you perform!</p>
                    
                    <div class="typing-container" id="test-container" style="margin-top: 30px;">
                        <div class="typing-header">
                            <div class="typing-stats">
                                <div class="typing-stat" id="test-wpm">WPM: 0</div>
                                <div class="typing-stat" id="test-accuracy">Accuracy: 0%</div>
                                <div class="typing-stat" id="test-time">Time: 1:00</div>
                            </div>
                        </div>
                        
                        <div class="typing-text" id="test-text">
                            Loading test text...
                        </div>
                        
                        <input type="text" class="typing-input" id="test-input" placeholder="Start typing here..." disabled>
                        
                        <div class="typing-controls">
                            <button class="btn btn-secondary" id="test-reset-btn">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <div>
                                <span>Test Duration: </span>
                                <select id="test-duration">
                                    <option value="1">1 minute</option>
                                    <option value="3">3 minutes</option>
                                    <option value="5">5 minutes</option>
                                </select>
                            </div>
                            <button class="btn btn-success" id="test-start-btn">
                                <i class="fas fa-play"></i> Start Test
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Competition Section -->
                <div class="content-section" id="competition-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-users"></i> Competition Mode</h2>
                    <p>Compete against a friend on the same screen to see who can type faster and more accurately!</p>
                    
                    <div class="competition-container" id="competition-container" style="margin-top: 30px;">
                        <div class="player-area">
                            <div class="player-header">
                                <div class="player-name">Player 1</div>
                                <div class="player-stats">
                                    <div class="typing-stat">WPM: <span id="p1-wpm">0</span></div>
                                    <div class="typing-stat">Acc: <span id="p1-acc">0%</span></div>
                                </div>
                            </div>
                            <div class="typing-text" id="p1-text">
                                Competition text will appear here when started...
                            </div>
                            <input type="text" class="typing-input" id="p1-input" placeholder="Player 1 typing area" disabled>
                        </div>
                        
                        <div class="player-area">
                            <div class="player-header">
                                <div class="player-name">Player 2</div>
                                <div class="player-stats">
                                    <div class="typing-stat">WPM: <span id="p2-wpm">0</span></div>
                                    <div class="typing-stat">Acc: <span id="p2-acc">0%</span></div>
                                </div>
                            </div>
                            <div class="typing-text" id="p2-text">
                                Competition text will appear here when started...
                            </div>
                            <input type="text" class="typing-input" id="p2-input" placeholder="Player 2 typing area" disabled>
                        </div>
                    </div>
                    
                    <div class="typing-controls" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-secondary" id="comp-reset-btn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button class="btn btn-success" id="comp-start-btn">
                            <i class="fas fa-play"></i> Start Competition
                        </button>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div class="content-section" id="achievements-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-trophy"></i> Achievements</h2>
                    <p>Earn badges by completing challenges and reaching milestones in your typing journey.</p>
                    
                    <h3 style="margin-top: 20px;">Your Badges</h3>
                    <div class="badges-grid" id="unlocked-badges">
                        <!-- Dynamically populated with unlocked badges -->
                    </div>
                    
                    <h3 style="margin-top: 30px;">Available Badges</h3>
                    <div class="badges-grid" id="locked-badges">
                        <!-- Dynamically populated with locked badges -->
                    </div>
                </div>

                <!-- Progress Section -->
                <div class="content-section" id="progress-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Your Progress</h2>
                    
                    <div class="progress-chart">
                        <h3>Daily XP Earned</h3>
                        <canvas id="xp-chart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px;">
                        <div class="stat-card">
                            <h3>Typing Stats</h3>
                            <ul style="list-style: none;">
                                <li style="margin-bottom: 10px;">Best WPM: <strong id="best-wpm">0</strong></li>
                                <li style="margin-bottom: 10px;">Average WPM: <strong id="avg-wpm">0</strong></li>
                                <li style="margin-bottom: 10px;">Best Accuracy: <strong id="best-acc">0%</strong></li>
                                <li style="margin-bottom: 10px;">Total Practice Time: <strong id="total-time">0</strong> minutes</li>
                                <li style="margin-bottom: 10px;">Lessons Completed: <strong id="lessons-completed">0</strong></li>
                                <li style="margin-bottom: 10px;">Tests Completed: <strong id="tests-completed">0</strong></li>
                            </ul>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Streak Calendar</h3>
                            <div id="streak-calendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
                                <!-- Dynamically populated with streak days -->
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3>Keyboard Heatmap</h3>
                        <p>See which keys you struggle with the most (darker colors indicate more mistakes)</p>
                        <div class="keyboard-container" id="heatmap-keyboard">
                            <!-- Keyboard with heatmap will be inserted here -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3>Typing Analysis</h3>
                        <div id="typing-analysis">
                            <!-- Analysis will be inserted here after enough data -->
                        </div>
                    </div>
                </div>

                <!-- Typing Games Section -->
                <div class="content-section" id="games-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-gamepad"></i> Typing Games</h2>
                    <p>Practice your typing skills with fun games that challenge your speed and accuracy!</p>
                    
                    <div class="lessons-grid" style="margin-top: 30px;">
                        <div class="lesson-card" id="falling-words-game">
                            <div class="lesson-level">Game</div>
                            <div class="lesson-title">Falling Words</div>
                            <div class="lesson-desc">Type the words before they reach the bottom!</div>
                            <div class="lesson-xp"><i class="fas fa-star"></i> +50 XP per minute</div>
                        </div>
                        
                        <div class="lesson-card" id="zombie-game">
                            <div class="lesson-level">Game</div>
                            <div class="lesson-title">Zombie Shooter</div>
                            <div class="lesson-desc">Type to shoot zombies before they get you!</div>
                            <div class="lesson-xp"><i class="fas fa-star"></i> +75 XP per minute</div>
                        </div>
                        
                        <div class="lesson-card" id="racer-game">
                            <div class="lesson-level">Game</div>
                            <div class="lesson-title">Speed Racer</div>
                            <div class="lesson-desc">Race against others by typing quickly!</div>
                            <div class="lesson-xp"><i class="fas fa-star"></i> +100 XP per minute</div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="content-section" id="settings-section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-cog"></i> Settings</h2>
                    
                    <div class="settings-panel">
                        <div class="setting-group">
                            <div class="setting-title"><i class="fas fa-palette"></i> Appearance</div>
                            <p>Select your preferred theme:</p>
                            <div class="theme-selector">
                                <div class="theme-option theme-default selected" data-theme="default"></div>
                                <div class="theme-option theme-dark" data-theme="dark"></div>
                                <div class="theme-option theme-red" data-theme="red"></div>
                                <div class="theme-option theme-green" data-theme="green"></div>
                                <div class="theme-option theme-blue" data-theme="blue"></div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <div class="setting-title"><i class="fas fa-keyboard"></i> Keyboard Layout</div>
                            <p>Select your keyboard layout:</p>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="keyboard-layout" value="qwerty" checked> QWERTY
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="keyboard-layout" value="dvorak"> Dvorak
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="keyboard-layout" value="colemak"> Colemak
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <div class="setting-title"><i class="fas fa-language"></i> Language</div>
                            <p>Select your preferred language:</p>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="language" value="english" checked> English
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="language" value="bangla"> Bangla (Avro)
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <div class="setting-title"><i class="fas fa-user"></i> Profile</div>
                            <p>Set your display name:</p>
                            <input type="text" id="username-input" placeholder="Your name" style="padding: 8px; width: 200px; border-radius: var(--border-radius); border: 1px solid #ccc;">
                            <button class="btn" id="save-username-btn" style="margin-left: 10px;">Save</button>
                        </div>
                        
                        <div class="setting-group">
                            <div class="setting-title"><i class="fas fa-database"></i> Data Management</div>
                            <p>Export or reset your data:</p>
                            <button class="btn" id="export-data-btn">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                            <button class="btn btn-danger" id="reset-data-btn" style="margin-left: 10px;">
                                <i class="fas fa-trash"></i> Reset All Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lesson Content Section -->
                <div class="content-section" id="lesson-content-section" style="display: none;">
                    <h2 class="section-title" id="lesson-title"><i class="fas fa-book"></i> Lesson</h2>
                    
                    <div class="typing-container">
                        <div class="typing-header">
                            <div class="typing-stats">
                                <div class="typing-stat" id="lesson-wpm">WPM: 0</div>
                                <div class="typing-stat" id="lesson-accuracy">Accuracy: 0%</div>
                                <div class="typing-stat" id="lesson-progress">Progress: 0%</div>
                            </div>
                        </div>
                        
                        <div class="typing-text" id="lesson-text">
                            Loading lesson text...
                        </div>
                        
                        <input type="text" class="typing-input" id="lesson-input" placeholder="Start typing here...">
                        
                        <div class="typing-controls">
                            <button class="btn btn-secondary" id="lesson-reset-btn">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button class="btn btn-success" id="lesson-complete-btn" disabled>
                                <i class="fas fa-check"></i> Complete Lesson
                            </button>
                        </div>
                    </div>
                    
                    <div class="keyboard-container" style="margin-top: 30px;">
                        <h3>Keyboard Guide</h3>
                        <div class="keyboard-row">
                            <div class="keyboard-key" data-key="`">~<div class="finger">LP</div></div>
                            <div class="keyboard-key" data-key="1">!<div class="finger">LP</div></div>
                            <div class="keyboard-key" data-key="2">@<div class="finger">LR</div></div>
                            <div class="keyboard-key" data-key="3">#<div class="finger">LM</div></div>
                            <div class="keyboard-key" data-key="4">$<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="5">%<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="6">^<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="7">&<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="8">*<div class="finger">RM</div></div>
                            <div class="keyboard-key" data-key="9">(<div class="finger">RR</div></div>
                            <div class="keyboard-key" data-key="0">)<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="-">_<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="=">+<div class="finger">RP</div></div>
                        </div>
                        <div class="keyboard-row">
                            <div class="keyboard-key" data-key="q">Q<div class="finger">LP</div></div>
                            <div class="keyboard-key" data-key="w">W<div class="finger">LR</div></div>
                            <div class="keyboard-key" data-key="e">E<div class="finger">LM</div></div>
                            <div class="keyboard-key" data-key="r">R<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="t">T<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="y">Y<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="u">U<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="i">I<div class="finger">RM</div></div>
                            <div class="keyboard-key" data-key="o">O<div class="finger">RR</div></div>
                            <div class="keyboard-key" data-key="p">P<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="[">{<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="]">}<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="\">|<div class="finger">RP</div></div>
                        </div>
                        <div class="keyboard-row">
                            <div class="keyboard-key" data-key="a">A<div class="finger">LP</div></div>
                            <div class="keyboard-key" data-key="s">S<div class="finger">LR</div></div>
                            <div class="keyboard-key" data-key="d">D<div class="finger">LM</div></div>
                            <div class="keyboard-key" data-key="f">F<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="g">G<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="h">H<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="j">J<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="k">K<div class="finger">RM</div></div>
                            <div class="keyboard-key" data-key="l">L<div class="finger">RR</div></div>
                            <div class="keyboard-key" data-key=";">:<div class="finger">RP</div></div>
                            <div class="keyboard-key" data-key="'">"<div class="finger">RP</div></div>
                        </div>
                        <div class="keyboard-row">
                            <div class="keyboard-key" data-key="z">Z<div class="finger">LP</div></div>
                            <div class="keyboard-key" data-key="x">X<div class="finger">LR</div></div>
                            <div class="keyboard-key" data-key="c">C<div class="finger">LM</div></div>
                            <div class="keyboard-key" data-key="v">V<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="b">B<div class="finger">LI</div></div>
                            <div class="keyboard-key" data-key="n">N<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key="m">M<div class="finger">RI</div></div>
                            <div class="keyboard-key" data-key=","><<div class="finger">RM</div></div>
                            <div class="keyboard-key" data-key=".">><div class="finger">RR</div></div>
                            <div class="keyboard-key" data-key="/">?<div class="finger">RP</div></div>
                        </div>
                        <div class="keyboard-row">
                            <div class="keyboard-key space" data-key=" ">SPACE<div class="finger">LT/RT</div></div>
                        </div>
                    </div>
                </div>

                <!-- Game Content Section -->
                <div class="content-section" id="game-content-section" style="display: none;">
                    <h2 class="section-title" id="game-title"><i class="fas fa-gamepad"></i> Game</h2>
                    <div id="game-container" style="width: 100%; height: 500px; background-color: #f0f0f0; position: relative; overflow: hidden; border-radius: var(--border-radius);">
                        <!-- Game content will be rendered here -->
                    </div>
                    <div class="typing-controls" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-secondary" id="game-reset-btn">
                            <i class="fas fa-redo"></i> Restart Game
                        </button>
                        <button class="btn btn-danger" id="game-exit-btn">
                            <i class="fas fa-times"></i> Exit Game
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="results-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Lesson Completed!</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="result-stats">
                <div class="result-stat">
                    <div class="result-stat-value" id="result-wpm">0</div>
                    <div class="result-stat-label">Words Per Minute</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="result-accuracy">0%</div>
                    <div class="result-stat-label">Accuracy</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="result-time">0s</div>
                    <div class="result-stat-label">Time Taken</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="result-mistakes">0</div>
                    <div class="result-stat-label">Mistakes</div>
                </div>
            </div>
            
            <div class="xp-earned" id="xp-earned">
                <i class="fas fa-star"></i> You earned <span id="xp-amount">100</span> XP!
            </div>
            
            <div id="bonus-xp-container" style="display: none;">
                <div class="xp-earned" style="background-color: rgba(79, 195, 247, 0.1);">
                    <i class="fas fa-bolt"></i> Bonus XP: <span id="bonus-xp-amount">0</span>
                </div>
            </div>
            
            <div id="badge-earned-container" style="display: none;">
                <div class="badge-earned">
                    <i class="fas fa-medal"></i> Achievement Unlocked: <span id="badge-name">100% Accuracy</span>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" id="next-lesson-btn">
                    <i class="fas fa-arrow-right"></i> Next Lesson
                </button>
                <button class="btn" id="practice-again-btn" style="margin-left: 10px;">
                    <i class="fas fa-redo"></i> Practice Again
                </button>
            </div>
        </div>
    </div>

    <!-- XP Popup -->
    <div class="xp-popup" id="xp-popup">
        +100 XP!
    </div>

    <script>
        // Main App Controller
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the app
            const app = new TypingMasterApp();
            app.init();
        });

        class TypingMasterApp {
            constructor() {
                this.userData = {
                    xp: 0,
                    level: 1,
                    lessonsCompleted: 0,
                    testsCompleted: 0,
                    bestWpm: 0,
                    bestAccuracy: 0,
                    totalPracticeTime: 0,
                    streak: 0,
                    lastPracticeDate: null,
                    weeklyXp: {},
                    keyboardHeatmap: {},
                    fingerStats: {},
                    achievements: [],
                    unlockedLessons: [1, 2, 3, 4, 5],
                    completedLessons: [],
                    inProgressLessons: [],
                    settings: {
                        theme: 'default',
                        keyboardLayout: 'qwerty',
                        language: 'english',
                        username: 'Typist'
                    }
                };
                
                this.currentLesson = null;
                this.currentGame = null;
                this.currentTest = null;
                this.currentCompetition = null;
                
                this.lessons = this.generateLessons();
                this.achievementsList = this.generateAchievements();
                this.gameTemplates = this.generateGameTemplates();
                
                // DOM Elements
                this.dom = {
                    contentArea: document.getElementById('content-area'),
                    contentSections: document.querySelectorAll('.content-section'),
                    sidebarLinks: document.querySelectorAll('.sidebar-menu a'),
                    
                    // User stats
                    xpDisplay: document.getElementById('xp-display'),
                    levelDisplay: document.getElementById('level-display'),
                    nextLevelXp: document.getElementById('next-level-xp'),
                    streakCount: document.getElementById('streak-count'),
                    
                    // Lesson elements
                    continueLessons: document.getElementById('continue-lessons'),
                    recommendedLessons: document.getElementById('recommended-lessons'),
                    beginnerLessons: document.getElementById('beginner-lessons'),
                    intermediateLessons: document.getElementById('intermediate-lessons'),
                    advancedLessons: document.getElementById('advanced-lessons'),
                    specializedLessons: document.getElementById('specialized-lessons'),
                    
                    // Lesson content
                    lessonContentSection: document.getElementById('lesson-content-section'),
                    lessonTitle: document.getElementById('lesson-title'),
                    lessonText: document.getElementById('lesson-text'),
                    lessonInput: document.getElementById('lesson-input'),
                    lessonWpm: document.getElementById('lesson-wpm'),
                    lessonAccuracy: document.getElementById('lesson-accuracy'),
                    lessonProgress: document.getElementById('lesson-progress'),
                    lessonResetBtn: document.getElementById('lesson-reset-btn'),
                    lessonCompleteBtn: document.getElementById('lesson-complete-btn'),
                    
                    // Test elements
                    testContainer: document.getElementById('test-container'),
                    testText: document.getElementById('test-text'),
                    testInput: document.getElementById('test-input'),
                    testWpm: document.getElementById('test-wpm'),
                    testAccuracy: document.getElementById('test-accuracy'),
                    testTime: document.getElementById('test-time'),
                    testStartBtn: document.getElementById('test-start-btn'),
                    testResetBtn: document.getElementById('test-reset-btn'),
                    testDuration: document.getElementById('test-duration'),
                    
                    // Competition elements
                    competitionContainer: document.getElementById('competition-container'),
                    p1Text: document.getElementById('p1-text'),
                    p1Input: document.getElementById('p1-input'),
                    p1Wpm: document.getElementById('p1-wpm'),
                    p1Acc: document.getElementById('p1-acc'),
                    p2Text: document.getElementById('p2-text'),
                    p2Input: document.getElementById('p2-input'),
                    p2Wpm: document.getElementById('p2-wpm'),
                    p2Acc: document.getElementById('p2-acc'),
                    compStartBtn: document.getElementById('comp-start-btn'),
                    compResetBtn: document.getElementById('comp-reset-btn'),
                    
                    // Achievements
                    unlockedBadges: document.getElementById('unlocked-badges'),
                    lockedBadges: document.getElementById('locked-badges'),
                    
                    // Progress
                    bestWpm: document.getElementById('best-wpm'),
                    avgWpm: document.getElementById('avg-wpm'),
                    bestAcc: document.getElementById('best-acc'),
                    totalTime: document.getElementById('total-time'),
                    lessonsCompleted: document.getElementById('lessons-completed'),
                    testsCompleted: document.getElementById('tests-completed'),
                    streakCalendar: document.getElementById('streak-calendar'),
                    heatmapKeyboard: document.getElementById('heatmap-keyboard'),
                    typingAnalysis: document.getElementById('typing-analysis'),
                    xpChart: document.getElementById('xp-chart'),
                    currentWeekXp: document.getElementById('current-week-xp'),
                    weeklyProgressBar: document.getElementById('weekly-progress-bar'),
                    
                    // Settings
                    themeOptions: document.querySelectorAll('.theme-option'),
                    keyboardLayouts: document.querySelectorAll('input[name="keyboard-layout"]'),
                    languages: document.querySelectorAll('input[name="language"]'),
                    usernameInput: document.getElementById('username-input'),
                    saveUsernameBtn: document.getElementById('save-username-btn'),
                    exportDataBtn: document.getElementById('export-data-btn'),
                    resetDataBtn: document.getElementById('reset-data-btn'),
                    
                    // Game elements
                    gameContentSection: document.getElementById('game-content-section'),
                    gameTitle: document.getElementById('game-title'),
                    gameContainer: document.getElementById('game-container'),
                    gameResetBtn: document.getElementById('game-reset-btn'),
                    gameExitBtn: document.getElementById('game-exit-btn'),
                    
                    // Results modal
                    resultsModal: document.getElementById('results-modal'),
                    resultWpm: document.getElementById('result-wpm'),
                    resultAccuracy: document.getElementById('result-accuracy'),
                    resultTime: document.getElementById('result-time'),
                    resultMistakes: document.getElementById('result-mistakes'),
                    xpEarned: document.getElementById('xp-earned'),
                    xpAmount: document.getElementById('xp-amount'),
                    bonusXpContainer: document.getElementById('bonus-xp-container'),
                    bonusXpAmount: document.getElementById('bonus-xp-amount'),
                    badgeEarnedContainer: document.getElementById('badge-earned-container'),
                    badgeName: document.getElementById('badge-name'),
                    nextLessonBtn: document.getElementById('next-lesson-btn'),
                    practiceAgainBtn: document.getElementById('practice-again-btn'),
                    closeModal: document.querySelector('.close-modal'),
                    
                    // XP popup
                    xpPopup: document.getElementById('xp-popup')
                };
                
                // Typing state
                this.typingState = {
                    startTime: null,
                    endTime: null,
                    mistakes: 0,
                    correctChars: 0,
                    totalChars: 0,
                    currentCharIndex: 0,
                    wpm: 0,
                    accuracy: 0,
                    timer: null,
                    isTyping: false
                };
                
                // Test state
                this.testState = {
                    timeLeft: 60,
                    timer: null,
                    isRunning: false,
                    text: '',
                    typedText: '',
                    correctChars: 0,
                    mistakes: 0
                };
                
                // Competition state
                this.competitionState = {
                    p1: {
                        typedText: '',
                        correctChars: 0,
                        mistakes: 0,
                        wpm: 0,
                        accuracy: 0,
                        finished: false
                    },
                    p2: {
                        typedText: '',
                        correctChars: 0,
                        mistakes: 0,
                        wpm: 0,
                        accuracy: 0,
                        finished: false
                    },
                    text: '',
                    startTime: null,
                    isRunning: false
                };
                
                // Game state
                this.gameState = {
                    type: null,
                    score: 0,
                    level: 1,
                    lives: 3,
                    isRunning: false,
                    elements: [],
                    timer: null
                };
            }
            
            init() {
                // Load user data from localStorage
                this.loadUserData();
                
                // Initialize UI
                this.updateUserStats();
                this.renderLessons();
                this.renderAchievements();
                this.renderProgress();
                this.initSettings();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Check streak
                this.checkStreak();
                
                // Show home section by default
                this.showSection('home');
            }
            
            loadUserData() {
                const savedData = localStorage.getItem('typingMasterData');
                if (savedData) {
                    this.userData = JSON.parse(savedData);
                }
                
                // Initialize heatmap if empty
                if (!this.userData.keyboardHeatmap || Object.keys(this.userData.keyboardHeatmap).length === 0) {
                    this.userData.keyboardHeatmap = this.initializeKeyboardHeatmap();
                }
                
                // Initialize finger stats if empty
                if (!this.userData.fingerStats || Object.keys(this.userData.fingerStats).length === 0) {
                    this.userData.fingerStats = this.initializeFingerStats();
                }
                
                // Initialize weekly XP if empty
                if (!this.userData.weeklyXp || Object.keys(this.userData.weeklyXp).length === 0) {
                    this.userData.weeklyXp = this.initializeWeeklyXp();
                }
            }
            
            saveUserData() {
                localStorage.setItem('typingMasterData', JSON.stringify(this.userData));
            }
            
            initializeKeyboardHeatmap() {
                const keys = [
                    '`', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=',
                    'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\\',
                    'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', "'",
                    'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', ' '
                ];
                
                const heatmap = {};
                keys.forEach(key => {
                    heatmap[key] = 0;
                });
                
                return heatmap;
            }
            
            initializeFingerStats() {
                return {
                    'LP': 0, // Left Pinky
                    'LR': 0, // Left Ring
                    'LM': 0, // Left Middle
                    'LI': 0, // Left Index
                    'RI': 0, // Right Index
                    'RM': 0, // Right Middle
                    'RR': 0, // Right Ring
                    'RP': 0, // Right Pinky
                    'LT': 0, // Left Thumb
                    'RT': 0  // Right Thumb
                };
            }
            
            initializeWeeklyXp() {
                const days = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
                const weeklyXp = {};
                
                days.forEach(day => {
                    weeklyXp[day] = 0;
                });
                
                return weeklyXp;
            }
            
            setupEventListeners() {
                // Sidebar navigation
                this.dom.sidebarLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.getAttribute('data-section');
                        this.showSection(section);
                        
                        // Update active state
                        this.dom.sidebarLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                });
                
                // Lesson input
                this.dom.lessonInput.addEventListener('input', (e) => {
                    this.handleLessonInput(e.target.value);
                });
                
                this.dom.lessonInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && this.dom.lessonCompleteBtn.disabled === false) {
                        this.completeLesson();
                    }
                });
                
                // Lesson controls
                this.dom.lessonResetBtn.addEventListener('click', () => {
                    this.resetLesson();
                });
                
                this.dom.lessonCompleteBtn.addEventListener('click', () => {
                    this.completeLesson();
                });
                
                // Test controls
                this.dom.testStartBtn.addEventListener('click', () => {
                    this.startTest();
                });
                
                this.dom.testResetBtn.addEventListener('click', () => {
                    this.resetTest();
                });
                
                this.dom.testInput.addEventListener('input', (e) => {
                    this.handleTestInput(e.target.value);
                });
                
                // Competition controls
                this.dom.compStartBtn.addEventListener('click', () => {
                    this.startCompetition();
                });
                
                this.dom.compResetBtn.addEventListener('click', () => {
                    this.resetCompetition();
                });
                
                this.dom.p1Input.addEventListener('input', (e) => {
                    this.handleCompetitionInput(1, e.target.value);
                });
                
                this.dom.p2Input.addEventListener('click', () => {
                    if (!this.competitionState.isRunning) return;
                    this.dom.p2Input.focus();
                });
                
                // Results modal
                this.dom.nextLessonBtn.addEventListener('click', () => {
                    this.findNextLesson();
                    this.closeResultsModal();
                });
                
                this.dom.practiceAgainBtn.addEventListener('click', () => {
                    this.resetLesson();
                    this.closeResultsModal();
                });
                
                this.dom.closeModal.addEventListener('click', () => {
                    this.closeResultsModal();
                });
                
                // Settings
                this.dom.themeOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        this.changeTheme(option.getAttribute('data-theme'));
                    });
                });
                
                this.dom.keyboardLayouts.forEach(layout => {
                    layout.addEventListener('change', (e) => {
                        this.userData.settings.keyboardLayout = e.target.value;
                        this.saveUserData();
                    });
                });
                
                this.dom.languages.forEach(lang => {
                    lang.addEventListener('change', (e) => {
                        this.userData.settings.language = e.target.value;
                        this.saveUserData();
                        this.renderLessons(); // Re-render lessons for new language
                    });
                });
                
                this.dom.saveUsernameBtn.addEventListener('click', () => {
                    const username = this.dom.usernameInput.value.trim();
                    if (username) {
                        this.userData.settings.username = username;
                        this.saveUserData();
                        this.showXpPopup(`Username set to ${username}`);
                    }
                });
                
                this.dom.exportDataBtn.addEventListener('click', () => {
                    this.exportUserData();
                });
                
                this.dom.resetDataBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to reset all your data? This cannot be undone.')) {
                        this.resetUserData();
                    }
                });
                
                // Game controls
                this.dom.gameResetBtn.addEventListener('click', () => {
                    this.resetGame();
                });
                
                this.dom.gameExitBtn.addEventListener('click', () => {
                    this.exitGame();
                });
                
                // Window events
                window.addEventListener('keydown', (e) => {
                    this.highlightKey(e.key.toLowerCase());
                });
                
                window.addEventListener('keyup', (e) => {
                    this.unhighlightKey(e.key.toLowerCase());
                });
            }
            
            showSection(section) {
                // Hide all sections
                this.dom.contentSections.forEach(sec => {
                    sec.style.display = 'none';
                });
                
                // Show the selected section
                document.getElementById(`${section}-section`).style.display = 'block';
                
                // Special handling for certain sections
                if (section === 'progress') {
                    this.renderProgressChart();
                }
            }
            
            updateUserStats() {
                this.dom.xpDisplay.textContent = this.userData.xp;
                this.dom.levelDisplay.textContent = this.userData.level;
                this.dom.nextLevelXp.textContent = this.getXpForNextLevel();
                this.dom.streakCount.textContent = this.userData.streak;
                
                // Update progress stats
                this.dom.bestWpm.textContent = this.userData.bestWpm;
                this.dom.bestAcc.textContent = `${this.userData.bestAccuracy}%`;
                this.dom.totalTime.textContent = this.userData.totalPracticeTime;
                this.dom.lessonsCompleted.textContent = this.userData.completedLessons.length;
                this.dom.testsCompleted.textContent = this.userData.testsCompleted;
                
                // Calculate average WPM (simplified for demo)
                const avgWpm = this.userData.completedLessons.length > 0 ? 
                    Math.round(this.userData.completedLessons.reduce((sum, lesson) => sum + lesson.wpm, 0) / this.userData.completedLessons.length) : 0;
                this.dom.avgWpm.textContent = avgWpm;
                
                // Update weekly XP
                const currentWeekXp = Object.values(this.userData.weeklyXp).reduce((sum, xp) => sum + xp, 0);
                this.dom.currentWeekXp.textContent = currentWeekXp;
                const progressPercent = Math.min(100, (currentWeekXp / 500) * 100);
                this.dom.weeklyProgressBar.style.width = `${progressPercent}%`;
                
                // Update username in settings
                this.dom.usernameInput.value = this.userData.settings.username;
            }
            
            getXpForNextLevel() {
                return this.userData.level * 200;
            }
            
            checkStreak() {
                const today = new Date().toDateString();
                const lastDate = this.userData.lastPracticeDate ? new Date(this.userData.lastPracticeDate).toDateString() : null;
                
                if (lastDate === today) {
                    // Already practiced today
                    return;
                }
                
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                yesterday.setHours(0, 0, 0, 0);
                
                if (!lastDate || new Date(lastDate) < yesterday) {
                    // Streak broken
                    this.userData.streak = 1;
                } else {
                    // Continue streak
                    this.userData.streak++;
                }
                
                this.userData.lastPracticeDate = new Date().toISOString();
                this.saveUserData();
                this.updateUserStats();
                
                // Show streak notification if streak > 1
                if (this.userData.streak > 1) {
                    this.showXpPopup(`Streak: ${this.userData.streak} days!`);
                }
            }
            
            renderLessons() {
                // Clear existing lessons
                this.dom.continueLessons.innerHTML = '';
                this.dom.recommendedLessons.innerHTML = '';
                this.dom.beginnerLessons.innerHTML = '';
                this.dom.intermediateLessons.innerHTML = '';
                this.dom.advancedLessons.innerHTML = '';
                this.dom.specializedLessons.innerHTML = '';
                
                // Filter lessons by language
                const languageLessons = this.lessons.filter(lesson => 
                    lesson.language === this.userData.settings.language || lesson.language === 'any'
                );
                
                // Group lessons by category
                const beginnerLessons = languageLessons.filter(lesson => lesson.category === 'beginner');
                const intermediateLessons = languageLessons.filter(lesson => lesson.category === 'intermediate');
                const advancedLessons = languageLessons.filter(lesson => lesson.category === 'advanced');
                const specializedLessons = languageLessons.filter(lesson => lesson.category === 'specialized');
                
                // Render continue lessons (in progress)
                this.userData.inProgressLessons.forEach(lessonId => {
                    const lesson = this.lessons.find(l => l.id === lessonId);
                    if (lesson) {
                        this.dom.continueLessons.appendChild(this.createLessonCard(lesson));
                    }
                });
                
                // Render recommended lessons (next unlocked)
                const nextLesson = this.findNextLesson(false);
                if (nextLesson) {
                    this.dom.recommendedLessons.appendChild(this.createLessonCard(nextLesson));
                }
                
                // Render beginner lessons
                beginnerLessons.forEach(lesson => {
                    this.dom.beginnerLessons.appendChild(this.createLessonCard(lesson));
                });
                
                // Render intermediate lessons
                intermediateLessons.forEach(lesson => {
                    this.dom.intermediateLessons.appendChild(this.createLessonCard(lesson));
                });
                
                // Render advanced lessons
                advancedLessons.forEach(lesson => {
                    this.dom.advancedLessons.appendChild(this.createLessonCard(lesson));
                });
                
                // Render specialized lessons
                specializedLessons.forEach(lesson => {
                    this.dom.specializedLessons.appendChild(this.createLessonCard(lesson));
                });
                
                // Add click handlers to all lesson cards
                document.querySelectorAll('.lesson-card').forEach(card => {
                    if (!card.classList.contains('locked')) {
                        card.addEventListener('click', () => {
                            const lessonId = parseInt(card.getAttribute('data-lesson-id'));
                            this.startLesson(lessonId);
                        });
                    }
                });
                
                // Add click handlers to game cards
                document.getElementById('falling-words-game').addEventListener('click', () => {
                    this.startGame('falling-words');
                });
                
                document.getElementById('zombie-game').addEventListener('click', () => {
                    this.startGame('zombie');
                });
                
                document.getElementById('racer-game').addEventListener('click', () => {
                    this.startGame('racer');
                });
            }
            
            createLessonCard(lesson) {
                const isUnlocked = this.userData.unlockedLessons.includes(lesson.id);
                const isCompleted = this.userData.completedLessons.some(l => l.id === lesson.id);
                
                const card = document.createElement('div');
                card.className = `lesson-card ${isUnlocked ? '' : 'locked'}`;
                card.setAttribute('data-lesson-id', lesson.id);
                
                let levelText = '';
                if (lesson.levelReq) {
                    levelText = `Level ${lesson.levelReq}`;
                } else if (lesson.xpReq) {
                    levelText = `${lesson.xpReq} XP`;
                }
                
                let completionBadge = '';
                if (isCompleted) {
                    completionBadge = '<span style="position: absolute; top: 5px; right: 5px; color: var(--success-color);">✓</span>';
                }
                
                card.innerHTML = `
                    <div class="lesson-level">${levelText}</div>
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-desc">${lesson.description}</div>
                    <div class="lesson-xp"><i class="fas fa-star"></i> +${lesson.xp} XP</div>
                    ${completionBadge}
                `;
                
                return card;
            }
            
            findNextLesson(showNotification = true) {
                // Find the first lesson that's unlocked but not completed
                const nextLesson = this.lessons.find(lesson => 
                    this.userData.unlockedLessons.includes(lesson.id) && 
                    !this.userData.completedLessons.some(l => l.id === lesson.id)
                );
                
                if (!nextLesson) {
                    // Find the first lesson that's not unlocked yet
                    const availableLesson = this.lessons.find(lesson => 
                        !this.userData.unlockedLessons.includes(lesson.id) &&
                        (lesson.levelReq <= this.userData.level || lesson.xpReq <= this.userData.xp)
                    );
                    
                    if (availableLesson) {
                        this.userData.unlockedLessons.push(availableLesson.id);
                        this.saveUserData();
                        this.renderLessons();
                        
                        if (showNotification) {
                            this.showXpPopup(`New lesson unlocked: ${availableLesson.title}`);
                        }
                        
                        return availableLesson;
                    }
                }
                
                return nextLesson;
            }
            
            startLesson(lessonId) {
                const lesson = this.lessons.find(l => l.id === lessonId);
                if (!lesson) return;
                
                this.currentLesson = lesson;
                
                // Update UI
                this.dom.lessonTitle.textContent = lesson.title;
                this.dom.lessonText.innerHTML = this.formatLessonText(lesson.text);
                this.dom.lessonInput.value = '';
                this.dom.lessonInput.disabled = false;
                this.dom.lessonCompleteBtn.disabled = true;
                
                // Reset typing state
                this.resetTypingState();
                this.typingState.totalChars = lesson.text.replace(/\s/g, '').length;
                
                // Show lesson section
                this.showSection('lesson-content');
                
                // Focus input
                setTimeout(() => {
                    this.dom.lessonInput.focus();
                }, 100);
            }
            
            formatLessonText(text) {
                return text.split('').map(char => {
                    if (char === ' ') {
                        return '<span class="space"> </span>';
                    }
                    return `<span>${char}</span>`;
                }).join('');
            }
            
            resetTypingState() {
                this.typingState = {
                    startTime: null,
                    endTime: null,
                    mistakes: 0,
                    correctChars: 0,
                    totalChars: 0,
                    currentCharIndex: 0,
                    wpm: 0,
                    accuracy: 0,
                    timer: null,
                    isTyping: false
                };
                
                // Reset all character highlights
                const spans = this.dom.lessonText.querySelectorAll('span');
                spans.forEach(span => {
                    span.className = '';
                    if (span.classList.contains('space')) {
                        span.classList.add('space');
                    }
                });
                
                // Highlight first character
                if (spans.length > 0) {
                    spans[0].classList.add('current');
                }
            }
            
            handleLessonInput(value) {
                if (!this.typingState.isTyping) {
                    // Start typing
                    this.typingState.startTime = new Date();
                    this.typingState.isTyping = true;
                    
                    // Start WPM timer
                    this.typingState.timer = setInterval(() => {
                        this.updateWpm();
                    }, 1000);
                }
                
                const spans = this.dom.lessonText.querySelectorAll('span:not(.space)');
                const currentSpan = spans[this.typingState.currentCharIndex];
                
                if (!currentSpan) {
                    // Lesson completed
                    this.finishLesson();
                    return;
                }
                
                const expectedChar = currentSpan.textContent;
                const typedChar = value[value.length - 1];
                
                if (typedChar === expectedChar) {
                    // Correct character
                    currentSpan.classList.remove('current');
                    currentSpan.classList.add('correct');
                    
                    this.typingState.correctChars++;
                    this.typingState.currentCharIndex++;
                    
                    // Highlight next character
                    if (spans[this.typingState.currentCharIndex]) {
                        spans[this.typingState.currentCharIndex].classList.add('current');
                    }
                    
                    // Update finger stats
                    this.updateFingerStats(expectedChar);
                } else {
                    // Incorrect character
                    currentSpan.classList.add('incorrect');
                    this.typingState.mistakes++;
                    
                    // Update keyboard heatmap
                    this.updateKeyboardHeatmap(expectedChar);
                    
                    // Shake animation for feedback
                    currentSpan.classList.add('shake');
                    setTimeout(() => {
                        currentSpan.classList.remove('shake');
                    }, 300);
                }
                
                // Clear input but keep focus
                this.dom.lessonInput.value = '';
                
                // Update progress
                const progress = Math.floor((this.typingState.currentCharIndex / this.typingState.totalChars) * 100);
                this.dom.lessonProgress.textContent = `Progress: ${progress}%`;
                
                // Enable complete button if at the end
                if (this.typingState.currentCharIndex >= spans.length) {
                    this.dom.lessonCompleteBtn.disabled = false;
                }
            }
            
            updateWpm() {
                if (!this.typingState.isTyping) return;
                
                const timeElapsed = (new Date() - this.typingState.startTime) / 1000 / 60; // in minutes
                const wordsTyped = this.typingState.correctChars / 5;
                const wpm = Math.round(wordsTyped / timeElapsed);
                
                this.typingState.wpm = wpm;
                this.dom.lessonWpm.textContent = `WPM: ${wpm}`;
                
                // Calculate accuracy
                const accuracy = this.typingState.correctChars > 0 ? 
                    Math.round((this.typingState.correctChars / (this.typingState.correctChars + this.typingState.mistakes)) * 100) : 0;
                this.typingState.accuracy = accuracy;
                this.dom.lessonAccuracy.textContent = `Accuracy: ${accuracy}%`;
            }
            
            updateFingerStats(char) {
                const keyMap = {
                    '`': 'LP', '1': 'LP', '2': 'LR', '3': 'LM', '4': 'LI', '5': 'LI',
                    '6': 'RI', '7': 'RI', '8': 'RM', '9': 'RR', '0': 'RP', '-': 'RP', '=': 'RP',
                    'q': 'LP', 'w': 'LR', 'e': 'LM', 'r': 'LI', 't': 'LI',
                    'y': 'RI', 'u': 'RI', 'i': 'RM', 'o': 'RR', 'p': 'RP', '[': 'RP', ']': 'RP', '\\': 'RP',
                    'a': 'LP', 's': 'LR', 'd': 'LM', 'f': 'LI', 'g': 'LI',
                    'h': 'RI', 'j': 'RI', 'k': 'RM', 'l': 'RR', ';': 'RP', "'": 'RP',
                    'z': 'LP', 'x': 'LR', 'c': 'LM', 'v': 'LI', 'b': 'LI',
                    'n': 'RI', 'm': 'RI', ',': 'RM', '.': 'RR', '/': 'RP',
                    ' ': 'LT' // Space by left thumb by default
                };
                
                const lowerChar = char.toLowerCase();
                const finger = keyMap[lowerChar] || 'LT';
                this.userData.fingerStats[finger] = (this.userData.fingerStats[finger] || 0) + 1;
            }
            
            updateKeyboardHeatmap(expectedChar) {
                const lowerChar = expectedChar.toLowerCase();
                if (this.userData.keyboardHeatmap.hasOwnProperty(lowerChar)) {
                    this.userData.keyboardHeatmap[lowerChar]++;
                }
            }
            
            resetLesson() {
                if (this.currentLesson) {
                    this.startLesson(this.currentLesson.id);
                }
            }
            
            finishLesson() {
                this.typingState.endTime = new Date();
                clearInterval(this.typingState.timer);
                
                // Calculate final WPM and accuracy
                const timeElapsed = (this.typingState.endTime - this.typingState.startTime) / 1000 / 60; // in minutes
                const wordsTyped = this.typingState.correctChars / 5;
                const wpm = Math.round(wordsTyped / timeElapsed);
                const accuracy = Math.round((this.typingState.correctChars / (this.typingState.correctChars + this.typingState.mistakes)) * 100);
                
                // Save lesson results
                const lessonResult = {
                    id: this.currentLesson.id,
                    wpm: wpm,
                    accuracy: accuracy,
                    mistakes: this.typingState.mistakes,
                    time: Math.round((this.typingState.endTime - this.typingState.startTime) / 1000),
                    date: new Date().toISOString()
                };
                
                // Add to completed lessons if not already there
                if (!this.userData.completedLessons.some(l => l.id === this.currentLesson.id)) {
                    this.userData.completedLessons.push(lessonResult);
                }
                
                // Remove from in-progress if it was there
                this.userData.inProgressLessons = this.userData.inProgressLessons.filter(id => id !== this.currentLesson.id);
                
                // Award XP
                let xpEarned = this.currentLesson.xp;
                let bonusXp = 0;
                
                // Bonus for high accuracy
                if (accuracy > 90) {
                    bonusXp += 25;
                }
                
                // Bonus for high speed
                if (wpm > 50) {
                    bonusXp += 50;
                }
                
                // Bonus for few mistakes
                if (this.typingState.mistakes < 3) {
                    bonusXp += 10;
                }
                
                xpEarned += bonusXp;
                this.userData.xp += xpEarned;
                
                // Update best stats
                if (wpm > this.userData.bestWpm) {
                    this.userData.bestWpm = wpm;
                }
                
                if (accuracy > this.userData.bestAccuracy) {
                    this.userData.bestAccuracy = accuracy;
                }
                
                // Update total practice time (in minutes)
                this.userData.totalPracticeTime += Math.round(timeElapsed);
                
                // Update weekly XP
                const today = new Date();
                const dayOfWeek = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'][today.getDay()];
                this.userData.weeklyXp[dayOfWeek] = (this.userData.weeklyXp[dayOfWeek] || 0) + xpEarned;
                
                // Check level up
                const xpNeeded = this.getXpForNextLevel();
                if (this.userData.xp >= xpNeeded) {
                    this.userData.level++;
                    this.showXpPopup(`Level Up! You're now level ${this.userData.level}`);
                }
                
                // Check achievements
                const unlockedAchievements = this.checkAchievements();
                
                // Save data
                this.saveUserData();
                this.updateUserStats();
                
                // Show results modal
                this.showResultsModal(wpm, accuracy, this.typingState.mistakes, 
                    Math.round((this.typingState.endTime - this.typingState.startTime) / 1000),
                    xpEarned, bonusXp, unlockedAchievements);
                
                // Disable input
                this.dom.lessonInput.disabled = true;
            }
            
            completeLesson() {
                this.finishLesson();
            }
            
            showResultsModal(wpm, accuracy, mistakes, time, xpEarned, bonusXp, unlockedAchievements) {
                this.dom.resultWpm.textContent = wpm;
                this.dom.resultAccuracy.textContent = `${accuracy}%`;
                this.dom.resultMistakes.textContent = mistakes;
                this.dom.resultTime.textContent = `${time}s`;
                this.dom.xpAmount.textContent = xpEarned;
                
                if (bonusXp > 0) {
                    this.dom.bonusXpAmount.textContent = bonusXp;
                    this.dom.bonusXpContainer.style.display = 'block';
                } else {
                    this.dom.bonusXpContainer.style.display = 'none';
                }
                
                if (unlockedAchievements.length > 0) {
                    this.dom.badgeName.textContent = unlockedAchievements[0].name;
                    this.dom.badgeEarnedContainer.style.display = 'flex';
                } else {
                    this.dom.badgeEarnedContainer.style.display = 'none';
                }
                
                this.dom.resultsModal.style.display = 'flex';
            }
            
            closeResultsModal() {
                this.dom.resultsModal.style.display = 'none';
                this.showSection('home');
            }
            
            checkAchievements() {
                const unlocked = [];
                
                this.achievementsList.forEach(achievement => {
                    if (this.userData.achievements.includes(achievement.id)) return;
                    
                    let isUnlocked = false;
                    
                    switch (achievement.id) {
                        case 1: // First Lesson
                            isUnlocked = this.userData.completedLessons.length >= 1;
                            break;
                        case 2: // 100% Accuracy
                            isUnlocked = this.userData.completedLessons.some(lesson => lesson.accuracy === 100);
                            break;
                        case 3: // WPM Over 60
                            isUnlocked = this.userData.completedLessons.some(lesson => lesson.wpm >= 60);
                            break;
                        case 4: // 10 Lessons
                            isUnlocked = this.userData.completedLessons.length >= 10;
                            break;
                        case 5: // 3 Day Streak
                            isUnlocked = this.userData.streak >= 3;
                            break;
                        case 6: // 7 Day Streak
                            isUnlocked = this.userData.streak >= 7;
                            break;
                        case 7: // Level 5
                            isUnlocked = this.userData.level >= 5;
                            break;
                        case 8: // 1000 XP
                            isUnlocked = this.userData.xp >= 1000;
                            break;
                        case 9: // 5000 XP
                            isUnlocked = this.userData.xp >= 5000;
                            break;
                        case 10: // All Beginner Lessons
                            const beginnerLessons = this.lessons.filter(l => l.category === 'beginner');
                            isUnlocked = beginnerLessons.every(lesson => 
                                this.userData.completedLessons.some(l => l.id === lesson.id)
                            );
                            break;
                    }
                    
                    if (isUnlocked) {
                        this.userData.achievements.push(achievement.id);
                        unlocked.push(achievement);
                    }
                });
                
                if (unlocked.length > 0) {
                    this.saveUserData();
                    this.renderAchievements();
                }
                
                return unlocked;
            }
            
            renderAchievements() {
                this.dom.unlockedBadges.innerHTML = '';
                this.dom.lockedBadges.innerHTML = '';
                
                this.achievementsList.forEach(achievement => {
                    const isUnlocked = this.userData.achievements.includes(achievement.id);
                    const container = isUnlocked ? this.dom.unlockedBadges : this.dom.lockedBadges;
                    
                    const badge = document.createElement('div');
                    badge.className = `badge-card ${isUnlocked ? '' : 'locked'}`;
                    badge.innerHTML = `
                        <div class="badge-icon">${achievement.emoji}</div>
                        <div class="badge-name">${achievement.name}</div>
                        <div class="badge-desc">${achievement.description}</div>
                    `;
                    
                    container.appendChild(badge);
                });
            }
            
            startTest() {
                if (this.testState.isRunning) return;
                
                const duration = parseInt(this.dom.testDuration.value);
                this.testState.timeLeft = duration * 60;
                this.testState.isRunning = true;
                this.testState.text = this.generateTestText();
                this.testState.typedText = '';
                this.testState.correctChars = 0;
                this.testState.mistakes = 0;
                
                // Update UI
                this.dom.testText.textContent = this.testState.text;
                this.dom.testInput.value = '';
                this.dom.testInput.disabled = false;
                this.dom.testStartBtn.disabled = true;
                this.dom.testStartBtn.textContent = 'Running...';
                
                // Start timer
                this.updateTestTimer();
                this.testState.timer = setInterval(() => {
                    this.testState.timeLeft--;
                    this.updateTestTimer();
                    
                    if (this.testState.timeLeft <= 0) {
                        this.finishTest();
                    }
                }, 1000);
                
                // Focus input
                setTimeout(() => {
                    this.dom.testInput.focus();
                }, 100);
            }
            
            generateTestText() {
                // For a real app, you'd want a larger collection of texts
                const testTexts = [
                    "The quick brown fox jumps over the lazy dog. This sentence contains all the letters in the English alphabet. Typing is an essential skill in today's digital world. Practice regularly to improve your speed and accuracy.",
                    "Programming is the process of creating a set of instructions that tell a computer how to perform a task. JavaScript is a programming language commonly used in web development. It allows you to implement complex features on web pages.",
                    "The rain in Spain stays mainly in the plain. This is a famous sentence used for practicing diction and pronunciation. It's also useful for typing practice as it contains a variety of common letter combinations.",
                    "To be or not to be, that is the question. This famous line from Shakespeare's Hamlet is known worldwide. Literature contains many such memorable quotes that can be used for typing practice exercises.",
                    "The mitochondria is the powerhouse of the cell. This biological fact is often remembered by students. Science texts provide excellent material for typing practice with specialized terminology."
                ];
                
                // Select random text and repeat it to fill the time
                const baseText = testTexts[Math.floor(Math.random() * testTexts.length)];
                let fullText = '';
                
                // Estimate how many times we need to repeat the text to fill the duration
                const wordsPerMinute = 50; // Average typing speed
                const wordCount = baseText.split(' ').length;
                const repeatsNeeded = Math.ceil((duration * wordsPerMinute) / wordCount);
                
                for (let i = 0; i < repeatsNeeded; i++) {
                    fullText += baseText + ' ';
                }
                
                return fullText.trim();
            }
            
            updateTestTimer() {
                const minutes = Math.floor(this.testState.timeLeft / 60);
                const seconds = this.testState.timeLeft % 60;
                this.dom.testTime.textContent = `Time: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }
            
            handleTestInput(value) {
                this.testState.typedText = value;
                
                // Calculate correct characters and mistakes
                let correctChars = 0;
                let mistakes = 0;
                
                for (let i = 0; i < value.length; i++) {
                    if (value[i] === this.testState.text[i]) {
                        correctChars++;
                    } else {
                        mistakes++;
                    }
                }
                
                this.testState.correctChars = correctChars;
                this.testState.mistakes = mistakes;
                
                // Calculate WPM
                const timeElapsed = (this.dom.testDuration.value * 60 - this.testState.timeLeft) / 60;
                const wordsTyped = correctChars / 5;
                const wpm = Math.round(wordsTyped / timeElapsed);
                
                // Calculate accuracy
                const accuracy = correctChars > 0 ? 
                    Math.round((correctChars / (correctChars + mistakes)) * 100) : 0;
                
                // Update UI
                this.dom.testWpm.textContent = `WPM: ${wpm}`;
                this.dom.testAccuracy.textContent = `Accuracy: ${accuracy}%`;
            }
            
            finishTest() {
                clearInterval(this.testState.timer);
                this.testState.isRunning = false;
                
                // Calculate final stats
                const duration = parseInt(this.dom.testDuration.value);
                const wordsTyped = this.testState.correctChars / 5;
                const wpm = Math.round(wordsTyped / duration);
                const accuracy = Math.round((this.testState.correctChars / (this.testState.correctChars + this.testState.mistakes)) * 100);
                
                // Save test results
                this.userData.testsCompleted++;
                
                // Update best stats
                if (wpm > this.userData.bestWpm) {
                    this.userData.bestWpm = wpm;
                }
                
                if (accuracy > this.userData.bestAccuracy) {
                    this.userData.bestAccuracy = accuracy;
                }
                
                // Update total practice time
                this.userData.totalPracticeTime += duration;
                
                // Update weekly XP
                const today = new Date();
                const dayOfWeek = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'][today.getDay()];
                this.userData.weeklyXp[dayOfWeek] = (this.userData.weeklyXp[dayOfWeek] || 0) + 50;
                
                // Award XP
                this.userData.xp += 50;
                
                // Check level up
                const xpNeeded = this.getXpForNextLevel();
                if (this.userData.xp >= xpNeeded) {
                    this.userData.level++;
                    this.showXpPopup(`Level Up! You're now level ${this.userData.level}`);
                }
                
                // Save data
                this.saveUserData();
                this.updateUserStats();
                
                // Show results
                alert(`Test completed!\nWPM: ${wpm}\nAccuracy: ${accuracy}%\nMistakes: ${this.testState.mistakes}`);
                
                // Reset UI
                this.dom.testStartBtn.disabled = false;
                this.dom.testStartBtn.textContent = 'Start Test';
                this.dom.testInput.disabled = true;
            }
            
            resetTest() {
                clearInterval(this.testState.timer);
                this.testState.isRunning = false;
                
                this.dom.testText.textContent = 'Loading test text...';
                this.dom.testInput.value = '';
                this.dom.testWpm.textContent = 'WPM: 0';
                this.dom.testAccuracy.textContent = 'Accuracy: 0%';
                this.dom.testTime.textContent = `Time: ${this.dom.testDuration.value}:00`;
                this.dom.testStartBtn.disabled = false;
                this.dom.testStartBtn.textContent = 'Start Test';
                this.dom.testInput.disabled = true;
            }
            
            startCompetition() {
                if (this.competitionState.isRunning) return;
                
                this.competitionState.isRunning = true;
                this.competitionState.text = this.generateCompetitionText();
                this.competitionState.startTime = new Date();
                
                // Reset player states
                this.competitionState.p1 = {
                    typedText: '',
                    correctChars: 0,
                    mistakes: 0,
                    wpm: 0,
                    accuracy: 0,
                    finished: false
                };
                
                this.competitionState.p2 = {
                    typedText: '',
                    correctChars: 0,
                    mistakes: 0,
                    wpm: 0,
                    accuracy: 0,
                    finished: false
                };
                
                // Update UI
                this.dom.p1Text.textContent = this.competitionState.text;
                this.dom.p2Text.textContent = this.competitionState.text;
                this.dom.p1Input.value = '';
                this.dom.p2Input.value = '';
                this.dom.p1Input.disabled = false;
                this.dom.p2Input.disabled = false;
                this.dom.compStartBtn.disabled = true;
                
                // Focus on P1 input
                setTimeout(() => {
                    this.dom.p1Input.focus();
                }, 100);
            }
            
            generateCompetitionText() {
                const sentences = [
                    "The quick brown fox jumps over the lazy dog.",
                    "Pack my box with five dozen liquor jugs.",
                    "How vexingly quick daft zebras jump!",
                    "Bright vixens jump; dozy fowl quack.",
                    "Sphinx of black quartz, judge my vow."
                ];
                
                // Combine 3 random sentences
                let text = '';
                for (let i = 0; i < 3; i++) {
                    text += sentences[Math.floor(Math.random() * sentences.length)] + ' ';
                }
                
                return text.trim();
            }
            
            handleCompetitionInput(player, value) {
                const playerState = player === 1 ? this.competitionState.p1 : this.competitionState.p2;
                playerState.typedText = value;
                
                // Calculate correct characters and mistakes
                let correctChars = 0;
                let mistakes = 0;
                
                for (let i = 0; i < value.length; i++) {
                    if (value[i] === this.competitionState.text[i]) {
                        correctChars++;
                    } else {
                        mistakes++;
                    }
                }
                
                playerState.correctChars = correctChars;
                playerState.mistakes = mistakes;
                
                // Calculate WPM
                const timeElapsed = (new Date() - this.competitionState.startTime) / 1000 / 60;
                const wordsTyped = correctChars / 5;
                const wpm = Math.round(wordsTyped / timeElapsed);
                
                // Calculate accuracy
                const accuracy = correctChars > 0 ? 
                    Math.round((correctChars / (correctChars + mistakes)) * 100) : 0;
                
                // Update player state
                playerState.wpm = wpm;
                playerState.accuracy = accuracy;
                
                // Update UI
                if (player === 1) {
                    this.dom.p1Wpm.textContent = wpm;
                    this.dom.p1Acc.textContent = `${accuracy}%`;
                } else {
                    this.dom.p2Wpm.textContent = wpm;
                    this.dom.p2Acc.textContent = `${accuracy}%`;
                }
                
                // Check if player finished
                if (value.length === this.competitionState.text.length) {
                    playerState.finished = true;
                    
                    // Disable input
                    if (player === 1) {
                        this.dom.p1Input.disabled = true;
                    } else {
                        this.dom.p2Input.disabled = true;
                    }
                    
                    // Check if both players finished
                    if (this.competitionState.p1.finished && this.competitionState.p2.finished) {
                        this.finishCompetition();
                    }
                }
            }
            
            finishCompetition() {
                this.competitionState.isRunning = false;
                
                // Determine winner
                let winner = 0;
                if (this.competitionState.p1.wpm > this.competitionState.p2.wpm) {
                    winner = 1;
                } else if (this.competitionState.p2.wpm > this.competitionState.p1.wpm) {
                    winner = 2;
                }
                
                // Show result
                let message = 'Competition finished!\n';
                message += `Player 1: ${this.competitionState.p1.wpm} WPM, ${this.competitionState.p1.accuracy}% accuracy\n`;
                message += `Player 2: ${this.competitionState.p2.wpm} WPM, ${this.competitionState.p2.accuracy}% accuracy\n`;
                
                if (winner === 0) {
                    message += "It's a tie!";
                } else {
                    message += `Player ${winner} wins!`;
                }
                
                alert(message);
                
                // Reset UI
                this.dom.compStartBtn.disabled = false;
            }
            
            resetCompetition() {
                this.competitionState.isRunning = false;
                
                this.dom.p1Text.textContent = 'Competition text will appear here when started...';
                this.dom.p2Text.textContent = 'Competition text will appear here when started...';
                this.dom.p1Input.value = '';
                this.dom.p2Input.value = '';
                this.dom.p1Wpm.textContent = '0';
                this.dom.p1Acc.textContent = '0%';
                this.dom.p2Wpm.textContent = '0';
                this.dom.p2Acc.textContent = '0%';
                this.dom.p1Input.disabled = true;
                this.dom.p2Input.disabled = true;
                this.dom.compStartBtn.disabled = false;
            }
            
            startGame(gameType) {
                this.currentGame = gameType;
                this.gameState = {
                    type: gameType,
                    score: 0,
                    level: 1,
                    lives: 3,
                    isRunning: true,
                    elements: [],
                    timer: null
                };
                
                // Update UI
                this.dom.gameTitle.textContent = this.gameTemplates[gameType].title;
                this.dom.gameContainer.innerHTML = '';
                this.showSection('game-content');
                
                // Start game loop
                this.gameState.timer = setInterval(() => {
                    this.updateGame();
                }, 1000 / 60); // 60 FPS
                
                // Start spawning elements
                this.spawnGameElement();
            }
            
            spawnGameElement() {
                if (!this.gameState.isRunning) return;
                
                const gameTemplate = this.gameTemplates[this.gameState.type];
                const element = {
                    x: Math.random() * (this.dom.gameContainer.offsetWidth - 100),
                    y: 0,
                    width: 100,
                    height: 30,
                    speed: 1 + Math.random() * this.gameState.level,
                    word: gameTemplate.words[Math.floor(Math.random() * gameTemplate.words.length)],
                    element: document.createElement('div')
                };
                
                element.element.className = 'game-element';
                element.element.style.left = `${element.x}px`;
                element.element.style.top = `${element.y}px`;
                element.element.style.width = `${element.width}px`;
                element.element.style.height = `${element.height}px`;
                element.element.textContent = element.word;
                
                this.dom.gameContainer.appendChild(element.element);
                this.gameState.elements.push(element);
                
                // Schedule next spawn
                const spawnDelay = Math.max(500, 2000 - (this.gameState.level * 100));
                setTimeout(() => this.spawnGameElement(), spawnDelay);
            }
            
            updateGame() {
                if (!this.gameState.isRunning) return;
                
                // Move elements
                this.gameState.elements.forEach((element, index) => {
                    element.y += element.speed;
                    element.element.style.top = `${element.y}px`;
                    
                    // Check if element reached bottom
                    if (element.y > this.dom.gameContainer.offsetHeight) {
                        this.dom.gameContainer.removeChild(element.element);
                        this.gameState.elements.splice(index, 1);
                        this.gameState.lives--;
                        
                        if (this.gameState.lives <= 0) {
                            this.gameOver();
                        }
                    }
                });
            }
            
            handleGameInput(word) {
                if (!this.gameState.isRunning) return;
                
                // Find matching element
                const elementIndex = this.gameState.elements.findIndex(el => el.word === word);
                if (elementIndex !== -1) {
                    const element = this.gameState.elements[elementIndex];
                    
                    // Remove element
                    this.dom.gameContainer.removeChild(element.element);
                    this.gameState.elements.splice(elementIndex, 1);
                    
                    // Increase score
                    this.gameState.score += 10 * this.gameState.level;
                    
                    // Level up every 100 points
                    if (this.gameState.score >= this.gameState.level * 100) {
                        this.gameState.level++;
                    }
                }
            }
            
            gameOver() {
                this.gameState.isRunning = false;
                clearInterval(this.gameState.timer);
                
                // Award XP based on score
                const xpEarned = Math.floor(this.gameState.score / 10);
                this.userData.xp += xpEarned;
                
                // Save data
                this.saveUserData();
                this.updateUserStats();
                
                // Show game over message
                alert(`Game Over!\nScore: ${this.gameState.score}\nLevel: ${this.gameState.level}\nYou earned ${xpEarned} XP!`);
            }
            
            resetGame() {
                clearInterval(this.gameState.timer);
                this.startGame(this.currentGame);
            }
            
            exitGame() {
                clearInterval(this.gameState.timer);
                this.showSection('games');
            }
            
            renderProgress() {
                // Render streak calendar
                this.dom.streakCalendar.innerHTML = '';
                
                // Simple 7-day streak display
                for (let i = 0; i < 7; i++) {
                    const day = document.createElement('div');
                    day.style.height = '30px';
                    day.style.display = 'flex';
                    day.style.alignItems = 'center';
                    day.style.justifyContent = 'center';
                    day.style.borderRadius = '5px';
                    
                    // For demo, just show current streak
                    if (i < this.userData.streak) {
                        day.style.backgroundColor = 'var(--success-color)';
                        day.style.color = 'white';
                        day.textContent = '✓';
                    } else {
                        day.style.backgroundColor = 'var(--card-bg)';
                        day.textContent = '';
                    }
                    
                    this.dom.streakCalendar.appendChild(day);
                }
                
                // Render keyboard heatmap
                this.renderKeyboardHeatmap();
                
                // Render typing analysis
                this.renderTypingAnalysis();
            }
            
            renderKeyboardHeatmap() {
                this.dom.heatmapKeyboard.innerHTML = '';
                
                // Create keyboard layout
                const rows = [
                    ['`', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '='],
                    ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\\'],
                    ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', "'"],
                    ['z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/'],
                    [' ']
                ];
                
                rows.forEach(rowKeys => {
                    const row = document.createElement('div');
                    row.className = 'keyboard-row';
                    
                    rowKeys.forEach(key => {
                        const keyElement = document.createElement('div');
                        keyElement.className = 'keyboard-key heatmap-key';
                        
                        if (key === ' ') {
                            keyElement.classList.add('space');
                            keyElement.textContent = 'SPACE';
                        } else {
                            keyElement.textContent = key;
                        }
                        
                        // Add heatmap value
                        const heatValue = this.userData.keyboardHeatmap[key] || 0;
                        const opacity = Math.min(0.8, heatValue / 10);
                        
                        if (heatValue > 0) {
                            const heat = document.createElement('div');
                            heat.className = 'heatmap-value';
                            heat.style.backgroundColor = `rgba(231, 76, 60, ${opacity})`;
                            keyElement.appendChild(heat);
                        }
                        
                        row.appendChild(keyElement);
                    });
                    
                    this.dom.heatmapKeyboard.appendChild(row);
                });
            }
            
            renderTypingAnalysis() {
                if (this.userData.completedLessons.length < 10) {
                    this.dom.typingAnalysis.innerHTML = `
                        <p>Complete at least 10 lessons to unlock detailed typing analysis.</p>
                    `;
                    return;
                }
                
                // Calculate finger usage percentages
                const totalStrokes = Object.values(this.userData.fingerStats).reduce((sum, val) => sum + val, 0);
                const fingerPercentages = {};
                
                for (const finger in this.userData.fingerStats) {
                    fingerPercentages[finger] = totalStrokes > 0 ? 
                        Math.round((this.userData.fingerStats[finger] / totalStrokes) * 100) : 0;
                }
                
                // Generate analysis HTML
                let html = `
                    <h4>Typing Style Analysis</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h5>Finger Usage</h5>
                            <ul style="list-style: none;">
                                <li>Left Pinky (LP): ${fingerPercentages['LP'] || 0}%</li>
                                <li>Left Ring (LR): ${fingerPercentages['LR'] || 0}%</li>
                                <li>Left Middle (LM): ${fingerPercentages['LM'] || 0}%</li>
                                <li>Left Index (LI): ${fingerPercentages['LI'] || 0}%</li>
                                <li>Right Index (RI): ${fingerPercentages['RI'] || 0}%</li>
                                <li>Right Middle (RM): ${fingerPercentages['RM'] || 0}%</li>
                                <li>Right Ring (RR): ${fingerPercentages['RR'] || 0}%</li>
                                <li>Right Pinky (RP): ${fingerPercentages['RP'] || 0}%</li>
                                <li>Thumbs: ${(fingerPercentages['LT'] || 0) + (fingerPercentages['RT'] || 0)}%</li>
                            </ul>
                        </div>
                        <div>
                            <h5>Hand Balance</h5>
                            <p>Left Hand: ${(fingerPercentages['LP'] + fingerPercentages['LR'] + fingerPercentages['LM'] + fingerPercentages['LI'])}%</p>
                            <p>Right Hand: ${(fingerPercentages['RI'] + fingerPercentages['RM'] + fingerPercentages['RR'] + fingerPercentages['RP'])}%</p>
                            
                            <h5 style="margin-top: 20px;">Common Mistakes</h5>
                            <p>Most mistyped keys:</p>
                            <ol>
                                ${this.getTopMistypedKeys(3).map(key => `<li>${key.key} (${key.mistakes} mistakes)</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                `;
                
                this.dom.typingAnalysis.innerHTML = html;
            }
            
            getTopMistypedKeys(count) {
                const keys = Object.entries(this.userData.keyboardHeatmap)
                    .map(([key, mistakes]) => ({ key, mistakes }))
                    .sort((a, b) => b.mistakes - a.mistakes);
                
                return keys.slice(0, count);
            }
            
            renderProgressChart() {
                // For a real app, you would use a charting library like Chart.js
                // This is a simplified version for the demo
                
                // Generate some sample data for the last 7 days
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const data = days.map(day => this.userData.weeklyXp[day.toLowerCase()] || 0);
                
                // Create a simple bar chart using CSS
                let html = '<div style="display: flex; height: 200px; align-items: flex-end; gap: 10px; margin-top: 15px;">';
                
                days.forEach((day, index) => {
                    const height = data[index] > 0 ? Math.min(100, (data[index] / 100) * 100) : 2;
                    html += `
                        <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                            <div style="background-color: var(--accent-color); width: 30px; height: ${height}%; border-radius: 5px 5px 0 0;"></div>
                            <div style="margin-top: 5px; font-size: 12px;">${day}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                this.dom.xpChart.innerHTML = html;
            }
            
            initSettings() {
                // Set current theme
                document.body.classList.remove('theme-dark', 'theme-red', 'theme-green', 'theme-blue');
                if (this.userData.settings.theme !== 'default') {
                    document.body.classList.add(`theme-${this.userData.settings.theme}`);
                }
                
                // Highlight selected theme
                this.dom.themeOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.getAttribute('data-theme') === this.userData.settings.theme) {
                        option.classList.add('selected');
                    }
                });
                
                // Set keyboard layout
                this.dom.keyboardLayouts.forEach(layout => {
                    layout.checked = layout.value === this.userData.settings.keyboardLayout;
                });
                
                // Set language
                this.dom.languages.forEach(lang => {
                    lang.checked = lang.value === this.userData.settings.language;
                });
            }
            
            changeTheme(theme) {
                document.body.classList.remove('theme-dark', 'theme-red', 'theme-green', 'theme-blue');
                
                if (theme !== 'default') {
                    document.body.classList.add(`theme-${theme}`);
                }
                
                this.userData.settings.theme = theme;
                this.saveUserData();
                
                // Update selected theme UI
                this.dom.themeOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.getAttribute('data-theme') === theme) {
                        option.classList.add('selected');
                    }
                });
            }
            
            highlightKey(key) {
                // Handle special keys
                if (key === ' ') {
                    key = 'space';
                } else if (key === 'shift' || key === 'control' || key === 'alt' || key === 'meta') {
                    return; // Skip modifier keys
                }
                
                const keyElement = document.querySelector(`.keyboard-key[data-key="${key}"]`);
                if (keyElement) {
                    keyElement.classList.add('active');
                }
            }
            
            unhighlightKey(key) {
                // Handle special keys
                if (key === ' ') {
                    key = 'space';
                } else if (key === 'shift' || key === 'control' || key === 'alt' || key === 'meta') {
                    return; // Skip modifier keys
                }
                
                const keyElement = document.querySelector(`.keyboard-key[data-key="${key}"]`);
                if (keyElement) {
                    keyElement.classList.remove('active');
                }
            }
            
            showXpPopup(message) {
                this.dom.xpPopup.textContent = message;
                this.dom.xpPopup.classList.add('show');
                
                setTimeout(() => {
                    this.dom.xpPopup.classList.remove('show');
                }, 2000);
            }
            
            exportUserData() {
                const dataStr = JSON.stringify(this.userData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportName = `typing-master-data-${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportName);
                linkElement.click();
            }
            
            resetUserData() {
                localStorage.removeItem('typingMasterData');
                this.userData = {
                    xp: 0,
                    level: 1,
                    lessonsCompleted: 0,
                    testsCompleted: 0,
                    bestWpm: 0,
                    bestAccuracy: 0,
                    totalPracticeTime: 0,
                    streak: 0,
                    lastPracticeDate: null,
                    weeklyXp: this.initializeWeeklyXp(),
                    keyboardHeatmap: this.initializeKeyboardHeatmap(),
                    fingerStats: this.initializeFingerStats(),
                    achievements: [],
                    unlockedLessons: [1, 2, 3, 4, 5],
                    completedLessons: [],
                    inProgressLessons: [],
                    settings: {
                        theme: 'default',
                        keyboardLayout: 'qwerty',
                        language: 'english',
                        username: 'Typist'
                    }
                };
                
                this.saveUserData();
                this.updateUserStats();
                this.renderLessons();
                this.renderAchievements();
                this.renderProgress();
                this.initSettings();
                
                this.showXpPopup('All data has been reset');
            }
            
            generateLessons() {
                return [
                    // Beginner lessons
                    {
                        id: 1,
                        title: "Home Row Basics",
                        description: "Learn the home row keys (ASDF JKL;)",
                        text: "asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl;",
                        category: "beginner",
                        levelReq: 1,
                        xp: 100,
                        language: "english"
                    },
                    {
                        id: 2,
                        title: "Home Row + G and H",
                        description: "Add G and H to your home row practice",
                        text: "asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl; asdfg hjkl;",
                        category: "beginner",
                        levelReq: 1,
                        xp: 100,
                        language: "english"
                    },
                    {
                        id: 3,
                        title: "Top Row Basics",
                        description: "Practice the QWER and UIOP keys",
                        text: "qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop qwer uiop",
                        category: "beginner",
                        levelReq: 1,
                        xp: 100,
                        language: "english"
                    },
                    {
                        id: 4,
                        title: "Bottom Row Basics",
                        description: "Practice the ZXCV and M,./ keys",
                        text: "zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./ zxcv m,./",
                        category: "beginner",
                        levelReq: 1,
                        xp: 100,
                        language: "english"
                    },
                    {
                        id: 5,
                        title: "All Letters",
                        description: "Practice all letter keys",
                        text: "qwertyuiop asdfghjkl; zxcvbnm,./ qwertyuiop asdfghjkl; zxcvbnm,./ qwertyuiop asdfghjkl; zxcvbnm,./ qwertyuiop asdfghjkl; zxcvbnm,./",
                        category: "beginner",
                        levelReq: 1,
                        xp: 100,
                        language: "english"
                    },
                    
                    // Intermediate lessons
                    {
                        id: 6,
                        title: "Simple Words",
                        description: "Practice typing simple words",
                        text: "the quick brown fox jumps over the lazy dog the quick brown fox jumps over the lazy dog the quick brown fox jumps over the lazy dog",
                        category: "intermediate",
                        levelReq: 2,
                        xp: 150,
                        language: "english"
                    },
                    {
                        id: 7,
                        title: "Common Words",
                        description: "Practice typing common English words",
                        text: "this is a test of your typing skills this is a test of your typing skills this is a test of your typing skills this is a test of your typing skills",
                        category: "intermediate",
                        levelReq: 2,
                        xp: 150,
                        language: "english"
                    },
                    {
                        id: 8,
                        title: "Short Sentences",
                        description: "Practice typing short sentences",
                        text: "I love to type. The sun is shining. My keyboard is great. Learning is fun. Practice makes perfect. I love to type. The sun is shining. My keyboard is great.",
                        category: "intermediate",
                        levelReq: 3,
                        xp: 150,
                        language: "english"
                    },
                    {
                        id: 9,
                        title: "Numbers and Symbols",
                        description: "Practice typing numbers and symbols",
                        text: "123 456 789 0 !@#$%^&*() 123 456 789 0 !@#$%^&*() 123 456 789 0 !@#$%^&*() 123 456 789 0 !@#$%^&*()",
                        category: "intermediate",
                        levelReq: 3,
                        xp: 150,
                        language: "english"
                    },
                    {
                        id: 10,
                        title: "Capital Letters",
                        description: "Practice typing with capital letters",
                        text: "The Quick Brown Fox Jumps Over The Lazy Dog. The Quick Brown Fox Jumps Over The Lazy Dog. The Quick Brown Fox Jumps Over The Lazy Dog.",
                        category: "intermediate",
                        levelReq: 3,
                        xp: 150,
                        language: "english"
                    },
                    
                    // Advanced lessons
                    {
                        id: 11,
                        title: "Long Sentences",
                        description: "Practice typing longer sentences",
                        text: "Typing is an essential skill in today's digital world, and practicing regularly can significantly improve your speed and accuracy over time. The more you type, the better you'll become at this crucial skill that's used in almost every profession.",
                        category: "advanced",
                        levelReq: 5,
                        xp: 200,
                        language: "english"
                    },
                    {
                        id: 12,
                        title: "Paragraph Practice",
                        description: "Practice typing full paragraphs",
                        text: "The ability to type quickly and accurately is becoming increasingly important in our technology-driven world. Whether you're writing an email, coding a program, or composing a document, good typing skills can save you time and reduce frustration. Regular practice with proper technique is the key to improvement.",
                        category: "advanced",
                        levelReq: 5,
                        xp: 200,
                        language: "english"
                    },
                    {
                        id: 13,
                        title: "Special Characters",
                        description: "Practice with various special characters",
                        text: "{} [] () <> !@#$%^&* ~`-_=+ \\|;:'\",./? {} [] () <> !@#$%^&* ~`-_=+ \\|;:'\",./? {} [] () <> !@#$%^&* ~`-_=+ \\|;:'\",./?",
                        category: "advanced",
                        levelReq: 6,
                        xp: 200,
                        language: "english"
                    },
                    {
                        id: 14,
                        title: "Mixed Content",
                        description: "Practice with mixed letters, numbers and symbols",
                        text: "Th3 qu1ck br0wn f0x jump5 0v3r th3 l@zy d0g! 1t's @ t3st 0f y0ur typ1ng sk1lls. C@n y0u typ3 th1s w1th0ut m@ny m1st@k3s? Th3 m0r3 y0u pr@ct1c3, th3 b3tt3r y0u'11 g3t!",
                        category: "advanced",
                        levelReq: 6,
                        xp: 200,
                        language: "english"
                    },
                    {
                        id: 15,
                        title: "Speed Challenge",
                        description: "Challenge yourself to type as fast as you can",
                        text: "Practice makes perfect when it comes to typing. The more you practice, the faster and more accurate you will become. Try to maintain a steady rhythm as you type these sentences. Focus on accuracy first, then gradually increase your speed over time.",
                        category: "advanced",
                        levelReq: 7,
                        xp: 200,
                        language: "english"
                    },
                    
                    // Specialized lessons
                    {
                        id: 16,
                        title: "Programming Basics",
                        description: "Practice typing common programming syntax",
                        text: "function helloWorld() { console.log('Hello, world!'); } const x = 5; let y = 10; if (x < y) { return true; } else { return false; } for (let i = 0; i < 10; i++) { console.log(i); }",
                        category: "specialized",
                        levelReq: 8,
                        xp: 250,
                        language: "english"
                    },
                    {
                        id: 17,
                        title: "Code Snippets",
                        description: "Practice typing actual code snippets",
                        text: "def factorial(n): if n == 0: return 1 else: return n * factorial(n-1) class Person: def __init__(self, name): self.name = name def greet(self): print(f'Hello, {self.name}!')",
                        category: "specialized",
                        levelReq: 8,
                        xp: 250,
                        language: "english"
                    },
                    {
                        id: 18,
                        title: "Technical Writing",
                        description: "Practice typing technical content",
                        text: "The Fibonacci sequence is a series of numbers where each number is the sum of the two preceding ones, usually starting with 0 and 1. In mathematical terms, the sequence Fn is defined by the recurrence relation Fn = Fn-1 + Fn-2, with seed values F0 = 0 and F1 = 1.",
                        category: "specialized",
                        levelReq: 9,
                        xp: 250,
                        language: "english"
                    },
                    {
                        id: 19,
                        title: "Bangla Basic (Avro)",
                        description: "বাংলা টাইপিং প্র্যাকটিস (আভ্রো লেআউট)",
                        text: "আমি বাংলায় গান গাই আমি বাংলায় গান গাই আমি বাংলায় গান গাই আমি বাংলায় গান গাই আমি বাংলায় গান গাই আমি বাংলায় গান গাই আমি বাংলায় গান গাই",
                        category: "specialized",
                        levelReq: 10,
                        xp: 250,
                        language: "bangla"
                    },
                    {
                        id: 20,
                        title: "Bangla Sentences (Avro)",
                        description: "বাংলা বাক্য টাইপিং প্র্যাকটিস (আভ্রো লেআউট)",
                        text: "আমার সোনার বাংলা আমি তোমায় ভালোবাসি। চিরদিন তোমার আকাশ তোমার বাতাস আমার প্রাণে বাজায় বাঁশি। আমার সোনার বাংলা আমি তোমায় ভালোবাসি।",
                        category: "specialized",
                        levelReq: 10,
                        xp: 250,
                        language: "bangla"
                    }
                ];
            }
            
            generateAchievements() {
                return [
                    {
                        id: 1,
                        name: "First Steps",
                        description: "Complete your first typing lesson",
                        emoji: "🎯"
                    },
                    {
                        id: 2,
                        name: "Perfect Score",
                        description: "Achieve 100% accuracy in a lesson",
                        emoji: "💯"
                    },
                    {
                        id: 3,
                        name: "Speed Demon",
                        description: "Type at 60 WPM or faster",
                        emoji: "⚡"
                    },
                    {
                        id: 4,
                        name: "Dedicated Learner",
                        description: "Complete 10 typing lessons",
                        emoji: "📚"
                    },
                    {
                        id: 5,
                        name: "3-Day Streak",
                        description: "Practice for 3 consecutive days",
                        emoji: "🔥"
                    },
                    {
                        id: 6,
                        name: "Weekly Habit",
                        description: "Practice for 7 consecutive days",
                        emoji: "🌟"
                    },
                    {
                        id: 7,
                        name: "Level 5",
                        description: "Reach level 5 in typing mastery",
                        emoji: "🏆"
                    },
                    {
                        id: 8,
                        name: "XP Master",
                        description: "Earn 1000 XP points",
                        emoji: "✨"
                    },
                    {
                        id: 9,
                        name: "Elite Typist",
                        description: "Earn 5000 XP points",
                        emoji: "👑"
                    },
                    {
                        id: 10,
                        name: "Beginner Master",
                        description: "Complete all beginner lessons",
                        emoji: "🎓"
                    }
                ];
            }
            
            generateGameTemplates() {
                return {
                    'falling-words': {
                        title: "Falling Words",
                        description: "Type the words before they reach the bottom!",
                        words: ["quick", "brown", "fox", "jumps", "over", "lazy", "dog", "typing", "practice", "speed", "accuracy", "keyboard", "lesson", "master", "skill"]
                    },
                    'zombie': {
                        title: "Zombie Shooter",
                        description: "Type to shoot zombies before they get you!",
                        words: ["headshot", "brain", "survive", "apocalypse", "undead", "ammo", "weapon", "health", "escape", "nightmare", "danger", "attack", "defend", "run", "hide"]
                    },
                    'racer': {
                        title: "Speed Racer",
                        description: "Race against others by typing quickly!",
                        words: ["speed", "race", "fast", "winner", "finish", "line", "lap", "track", "engine", "tires", "podium", "champion", "victory", "checkered", "flag"]
                    }
                };
            }
        }
    </script>
</body>
</html>